<!DOCTYPE html>
<html>
<head>
  <title>Xfight Club â€“ Login & Register</title>
  <style>
    body {
      background: #0d1117;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 50px;
    }
    .container {
      background: #161b22;
      padding: 30px;
      border-radius: 8px;
      width: 300px;
      text-align: center;
    }
    input {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      background: #0d1117;
      border: 1px solid #30363d;
      color: white;
    }
    button {
      padding: 10px;
      background: #238636;
      color: white;
      border: none;
      width: 100%;
      cursor: pointer;
    }
    button:hover {
      background: #2ea043;
    }
    .toggle {
      margin-top: 10px;
      cursor: pointer;
      color: #58a6ff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 id="form-title">Login</h2>
    <input type="text" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <input type="text" id="ign" placeholder="Minecraft IGN" style="display: none;">
    <input type="password" id="retype" placeholder="Retype Password" style="display: none;">
    <button id="actionBtn">Login</button>
    <div class="toggle" id="toggleForm">Don't have an account? Register</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-auth.js";
    import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAPrcws5Yu-oYkJNfUXten17goXK2FnKUg",
      authDomain: "xfight-club.firebaseapp.com",
      projectId: "xfight-club",
      storageBucket: "xfight-club.firebasestorage.app",
      messagingSenderId: "798788118687",
      appId: "1:798788118687:web:319f89f5f60607310b1aaa",
      measurementId: "G-KTH8MZSER1",
      databaseURL: "https://xfight-club-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const email = document.getElementById("email");
    const password = document.getElementById("password");
    const ign = document.getElementById("ign");
    const retype = document.getElementById("retype");
    const actionBtn = document.getElementById("actionBtn");
    const toggleForm = document.getElementById("toggleForm");
    const formTitle = document.getElementById("form-title");

    let isLogin = true;

    toggleForm.onclick = () => {
      isLogin = !isLogin;
      formTitle.innerText = isLogin ? "Login" : "Register";
      actionBtn.innerText = isLogin ? "Login" : "Register";
      toggleForm.innerText = isLogin ? "Don't have an account? Register" : "Already have an account? Login";
      ign.style.display = isLogin ? "none" : "block";
      retype.style.display = isLogin ? "none" : "block";
    };

    actionBtn.onclick = async () => {
      if (isLogin) {
        signInWithEmailAndPassword(auth, email.value, password.value)
          .then(() => window.location.href = "dashboard.html")
          .catch(err => alert("Login failed: " + err.message));
      } else {
        if (password.value !== retype.value) {
          alert("Passwords do not match.");
          return;
        }
        createUserWithEmailAndPassword(auth, email.value, password.value)
          .then((cred) => {
            set(ref(db, "users/" + cred.user.uid), {
              email: email.value,
              ign: ign.value,
              coins: 0
            });
            window.location.href = "dashboard.html";
          })
          .catch(err => alert("Registration failed: " + err.message));
      }
    };

    onAuthStateChanged(auth, (user) => {
      if (user) {
        window.location.href = "dashboard.html";
      }
    });
  </script>
</body>
</html>
