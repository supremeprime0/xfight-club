<!DOCTYPE html>
<html>
<head>
  <title>Xfight Club - Dashboard</title>
  <meta charset="UTF-8">
  <style>
    body {
      background-color: #0f0f0f;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }

    h1, h2 {
      color: #00ffd5;
    }

    .button {
      background: #00ffd5;
      color: #000;
      padding: 10px;
      margin: 5px 0;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .button:hover {
      background: #00cbb0;
    }

    .link-button {
      display: block;
      margin: 10px 0;
    }

    .store, .admin-panel {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
    }

    input {
      padding: 8px;
      margin-right: 10px;
    }

    .logout {
      float: right;
      background: red;
      color: white;
    }
  </style>
</head>
<body>
  <button class="button logout" onclick="logout()">Logout</button>
  <h1>Welcome to Xfight Club</h1>
  <p><strong>IGN:</strong> <span id="ignDisplay"></span></p>
  <p><strong>Xcoins:</strong> <span id="coinDisplay">0</span></p>

  <h2>ðŸ”¥ Earn Coins</h2>
  <div id="linkContainer"></div>

  <div class="store">
    <h2>ðŸ›’ Store</h2>
    <div id="storeItems"></div>
  </div>

  <div id="adminPanel" class="admin-panel" style="display: none;">
    <h2>ðŸ‘‘ Admin Panel</h2>
    <input type="text" id="targetIGN" placeholder="Target IGN">
    <input type="number" id="addAmount" placeholder="Amount">
    <button onclick="addCoinsToUser()">Add Coins</button>
    <div id="adminMessage"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, get, child, set } from "https://www.gstatic.com/firebasejs/11.10.1/firebase-database.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.10.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAPrcws5Yu-oYkJNfUXten17goXK2FnKUg",
      authDomain: "xfight-club.firebaseapp.com",
      projectId: "xfight-club",
      databaseURL: "https://xfight-club-default-rtdb.firebaseio.com",
      storageBucket: "xfight-club.appspot.com",
      messagingSenderId: "798788118687",
      appId: "1:798788118687:web:319f89f5f60607310b1aaa"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const ign = localStorage.getItem("xfight_ign");
    document.getElementById("ignDisplay").innerText = ign;

    let userEmail = "";

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        alert("Please login first.");
        window.location.href = "index.html";
      } else {
        userEmail = user.email;
        const userRef = ref(db, 'users/' + ign);
        onValue(userRef, snapshot => {
          const data = snapshot.val();
          if (data) {
            document.getElementById("coinDisplay").innerText = data.xcoins || 0;
            const today = new Date().toISOString().split('T')[0];

            if (data.lastClaimDate !== today) {
              update(userRef, { linksCompletedToday: 0, lastClaimDate: today });
            }

            generateLinkButtons(data.linksCompletedToday || 0);
          }
        });

        if (user.email === "supremeprime.gg@gmail.com" && ign === "protier") {
          document.getElementById("adminPanel").style.display = "block";
        }
      }
    });

    function logout() {
      signOut(auth).then(() => {
        localStorage.removeItem("xfight_ign");
        window.location.href = "index.html";
      });
    }

    function generateLinkButtons(count) {
      const container = document.getElementById("linkContainer");
      container.innerHTML = "";

      for (let i = 1; i <= 10; i++) {
        const btn = document.createElement("button");
        btn.className = "button link-button";
        btn.innerText = count >= i ? `âœ… Link ${i} completed` : `Visit Link ${i}`;
        btn.disabled = count >= i;
        btn.onclick = () => completeLink(i);
        container.appendChild(btn);
      }
    }

    function completeLink(index) {
      const shortlink = "https://ouo.io/ImUWsS";
      window.open(shortlink, "_blank");

      setTimeout(() => {
        const userRef = ref(db, 'users/' + ign);
        get(userRef).then(snapshot => {
          const userData = snapshot.val();
          if (userData && (userData.linksCompletedToday || 0) < index) {
            const newCount = index;
            const newCoins = (userData.xcoins || 0) + 10;
            update(userRef, {
              xcoins: newCoins,
              linksCompletedToday: newCount
            });
            alert(`You earned +10 Xcoins!`);
          }
        });
      }, 3000);
    }

    const storeItems = [
      { name: "X-VIP", cost: 1000 },
      { name: "X-VIP+", cost: 1500 },
      { name: "X-MVP", cost: 2000 },
      { name: "X-MVP+", cost: 2500 },
      { name: "X-MVP++", cost: 3000 },
      { name: "X-Men", cost: 5000 },
      { name: "X-Women", cost: 5000 }
    ];

    const storeContainer = document.getElementById("storeItems");
    storeItems.forEach(item => {
      const btn = document.createElement("button");
      btn.className = "button";
      btn.innerText = `${item.name} - ${item.cost} Xcoins`;
      btn.onclick = () => purchaseItem(item.name, item.cost);
      storeContainer.appendChild(btn);
    });

    function purchaseItem(name, cost) {
      const userRef = ref(db, 'users/' + ign);
      get(userRef).then(snapshot => {
        const data = snapshot.val();
        if (data.xcoins >= cost) {
          update(userRef, { xcoins: data.xcoins - cost });
          alert(`You purchased ${name}!`);
        } else {
          alert("Not enough Xcoins.");
        }
      });
    }

    window.addCoinsToUser = () => {
      const targetIGN = document.getElementById("targetIGN").value;
      const amount = parseInt(document.getElementById("addAmount").value);
      if (!targetIGN || isNaN(amount)) return;

      const targetRef = ref(db, 'users/' + targetIGN);
      get(targetRef).then(snapshot => {
        if (!snapshot.exists()) {
          alert("IGN not found.");
          return;
        }
        const current = snapshot.val().xcoins || 0;
        update(targetRef, { xcoins: current + amount });
        document.getElementById("adminMessage").innerText = `Added ${amount} Xcoins to ${targetIGN}`;
      });
    };
  </script>
</body>
</html>
